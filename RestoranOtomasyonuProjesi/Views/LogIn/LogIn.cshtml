
@{
    ViewBag.Title = "LogIn";
    List<EntityLayer.Concrete.User> users = ViewBag.users;
    EntityLayer.Concrete.User u = ViewBag.u != null ? ViewBag.u : null;
    Layout = "~/Views/Shared/_LogInLayout.cshtml";
}

<form action="@Url.Action("LogIn", "LogIn")" method="post" role="form">
    <div class="row justify-content-center text-center">
        <div class="col-sm-8 col-md-8 col-lg-6 col-xl-6 col-xxl-6">
            <br />
            <br />
            <h3 class="mb-3">Giriş Yap</h3>
            <br />
            <div hidden class="alert alert-danger" role="alert" id="alert">
                <i class="fas fa-exclamation me-2"></i>
                Lütfen bilgilerinizi kontrol ediniz.
            </div>
            <br />
            <div class="input-group">
                <span class="input-group-text" id="basic-addon1"><i class="fas fa-phone"></i></span>
                <input class="form-control" type="tel" name="PhoneNumber" placeholder="Telefon Numarası" maxlength="10" id="phone" />
            </div>

            <div class="clearfix"></div>

            <div class="input-group mt-2">
                <span class="input-group-text"><i class="fas fa-key"></i></span>
                <input type="password" class="form-control" name="Password" placeholder="Şifre" value="@(u != null ? u.Password : "")" id="password">
                <span role="button" class="input-group-text" id="showPassword"><i class="fas fa-eye"></i></span>
            </div>
            <br />
            <button class="w-50 btn btn-sm btn-primary mt-3" type="button" id="login"><i class="fas fa-sign-in-alt me-2"></i>Giriş Yap</button>
            <br />
            <br />
            <br />
        </div>
    </div>
</form>

@section button{
    <a class="float-end" href="@Url.Action("Entry", "LogIn")">
        Geri Dön
        <i class="fas fa-sign-out-alt ms-2"></i>
    </a>
}
@section style{
    <style>
        .absolute-center {
            width: 100%;
            height: 300px;
            margin: auto;
            position: absolute;
            top: 0;
            bottom: 0;
            text-align: center !important;
        }
    </style>
}
@section script{
    <script type="text/javascript">
        $('document').ready(function () {
            $('#showPassword').click(function () {
                $('#password').attr("type", $('#password').attr("type") == "password" ? "text" : "password");
            });

            $('input').on('input', function () {
                $('#alert').attr('hidden', true);
            });

            $('#login').click(function () {
                console.log("deneme");
                var phoneNumber = $('#phone').val();
                var pass = $('#password').val();
                console.log("phone:" + phoneNumber);
                console.log("pass:" + pass);
                $.ajax({
                    url: "@Url.Action("CheckUser", "LogIn")",
                    type: 'post',
                    dataType: 'json',
                    data: "{phone:'" + phoneNumber + "',password:'" + pass + "'}",
                    contentType: 'application/json; charset=utf-8',
                    success: function (data) {
                        if (data.confirm) {
                            $('#alert').attr('hidden', true);
                            window.location.href = data.destination;
                        }
                        else {
                            $('#alert').attr('hidden', false);
                        }
                    },
                    error: function () {

                    }
                });
            });
        });
    </script>
}